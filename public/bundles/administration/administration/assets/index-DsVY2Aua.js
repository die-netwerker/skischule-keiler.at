const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C5H1QfDX.js","assets/index-D9lDzHRE.css","assets/index-CRvZpqS8.js","assets/index-DGBsDSla.css","assets/index-D5o0j6kg.js","assets/index-8LRsC7Gr.css","assets/index-j2QiQMPv.js","assets/index-BfYnF1XK.css","assets/index-CbEpgJrF.js","assets/index-CbJ5uoJV.css","assets/index-QGuQWuIX.js","assets/index-D_hK5z0f.css","assets/index-BiVKHvoA.js","assets/index-CZdYCxXE.css","assets/index-BnxjrPzf.js","assets/index-BK68ErnY.css","assets/index-DQ3gJEnU.js","assets/index-D6vjOMVZ.css","assets/index-CrbP2RUY.js","assets/index-B5PfroSC.css","assets/index-IVv7628l.js","assets/main-DLOZxWIX.js","assets/channel-D6fkBpuJ.js","assets/administration-BkFWn-Oy.js","assets/administration-DX5ywH2m.css","assets/main-0YhLQqqP.css","assets/index-CvCOfDVR.css","assets/index-D8U1zwyH.js","assets/index-ybtBht3-.css","assets/index-BNbkGdXo.js","assets/index-CJq7z4OL.css","assets/index-AUPdPW-k.js","assets/index-BmnZrzAC.css","assets/index-DD8ijXSo.js","assets/string.utils-BjgJ7cn9.js","assets/camelCase-AQftrnVC.js","assets/index-YHVk0LUL.css","assets/index-CGJDKSST.js","assets/index-D5pDRlEV.css","assets/index-CECC1vmE.js","assets/_baseIteratee-Dn-eCNgF.js","assets/_baseUniq-DwRlPR15.js","assets/index-BE3xEz5J.css","assets/index-B7XNkGXm.js","assets/index-DU1UURm3.css","assets/index-C6QNqVtQ.js","assets/index-BXuU9lP5.css","assets/index-C6nKZU-3.js","assets/index-49r1AyAS.css","assets/index-SPknUrKR.js","assets/index-CgA4Gdl7.css"])))=>i.map(i=>d[i]);
import{_ as a}from"./administration-BkFWn-Oy.js";import{A as g}from"./api.service-Dyd0zpin.js";import"./channel-D6fkBpuJ.js";class _ extends g{constructor(t,e,r="import-export"){super(t,e,r),this.onProgressStartedListener=[],this.name="importExportService",this.httpClient=t}async export(t,e,r){const i=new Date;i.setDate(i.getDate()+30);const o=await this.httpClient.post("/_action/import-export/prepare",{profileId:t,config:r,expireDate:i.toDateString()},{headers:this.getBasicHeaders()});return this.trackProgress(o,e)}async getDownloadUrl(t){const e=await this.httpClient.post(`/_action/import-export/file/prepare-download/${t}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${t}&accessToken=${e.data.accessToken}`}async getTemplateFileDownloadUrl(t){const e=await this.httpClient.post(`/_action/import-export/prepare-template-file-download?profileId=${t}`,{},{headers:this.getBasicHeaders()});return`${Shopware.Context.api.apiPath||""}/_action/${this.getApiBasePath()}/file/download?fileId=${e.data.fileId}&accessToken=${e.data.accessToken}`}getMappingFromTemplate(t,e,r=";",i='"'){const o=new FormData;return o.append("file",t),o.append("sourceEntity",e),o.append("delimiter",r),o.append("enclosure",i),this.httpClient.post("/_action/import-export/mapping-from-template",o,{headers:this.getBasicHeaders({"Content-Type":"multipart/form-data"})}).then(s=>s.data?Promise.resolve(s.data):Promise.reject(new Error("Empty response data")))}async import(t,e,r,i={},o=!1){const s=new Date;s.setDate(s.getDate()+30);const n=new FormData;e&&n.append("file",e),n.append("profileId",t),n.append("expireDate",s.toDateString()),o&&n.append("dryRun","true"),Object.entries(i).forEach(([d,l])=>{n.append(`config[${d}]`,JSON.stringify(l))});const p=await this.httpClient.post("/_action/import-export/prepare",n,{headers:this.getBasicHeaders({"Content-Type":"multipart/form-data"})});return this.trackProgress(p,r)}async trackProgress(t,e){return await this.httpClient.post("/_action/import-export/process",{logId:t.data.log.id},{headers:this.getBasicHeaders()}),e.call(this,t.data.log),this.onProgressStartedListener.forEach(r=>{r.call(this)}),t}addOnProgressStartedListener(t){this.onProgressStartedListener.push(t)}cancel(t){return this.httpClient.post(`/_action/${this.getApiBasePath()}/cancel`,{logId:t},{headers:this.getBasicHeaders()}).then(g.handleResponse.bind(this))}}class u{constructor(t){this.EntityDefinition=t}validate(t,e,r=[],i=!1){const o=this.convertMappingKeys(e),s=this.convertMappingKeys(r),n=this.EntityDefinition.getRequiredFields(t);let p=[];if(Object.keys(n).forEach(d=>{d==="translations"||d==="price"||s.length>0&&!s.some(m=>d===m)||o.includes(d)||p.push(d)}),i){const l=this.EntityDefinition.get(t).getPrimaryKeyFields();p=p.filter(m=>l[m]!==void 0)}return{missingRequiredFields:p}}convertMappingKeys(t){const e=t.map(r=>r.key);return e.forEach(r=>{const i=r.split(".");i.includes("translations")&&e.push(i.slice(2).join(""));const o=r.split(".id");o.length===2&&i.length===2&&e.push(`${o[0]}Id`)}),e}getSystemRequiredFields(t,e=1){const r=this.EntityDefinition.get(t);return this._getSystemRequiredFieldsForEntityCreation(r,e)}_getSystemRequiredFieldsForEntityCreation(t,e=1,r="",i={}){let o={};return e<=0||i[t.getEntity()]!==void 0||r.endsWith("translations.DEFAULT.language.")||(i[t.getEntity()]=t.getEntity(),t.forEachField((s,n,p)=>{o={...o,...this._handleField(s,n,p,e,r,i)}})),o}_handleField(t,e,r,i,o,s){var d,l;let n={};if(t.type==="association"&&t.relation==="many_to_one"&&((l=(d=r[t.localField])==null?void 0:d.flags)==null?void 0:l.required)===!0)return n={...n,...this._handleAssociation(t,e,r,i,o,s)},n;if(t.flags.required!==!0||e==="createdAt"||e.toLowerCase().includes("versionid")||t.flags.translatable===!0||t.type==="uuid"&&e!=="id")return n;if(e==="translations"&&t.type==="association"&&t.flags.required===!0)return n={...n,...this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(t.entity),i,`${o}${e}.DEFAULT.`,s)},n;if(e==="price"&&t.type==="json_object")return n={...n,...this._addPriceFields(o,e)},n;const p=`${o}${e}`;return n[p]=p,n}_handleAssociation(t,e,r,i,o,s){const n={},p=`${o}${e}.`;if(s[t.entity]===void 0&&!p.endsWith("translations.DEFAULT.language.")){const l=`${p}${t.referenceField}`;n[l]=l}const d=this._getSystemRequiredFieldsForEntityCreation(this.EntityDefinition.get(t.entity),i-1,p,s);return{...n,...d}}_addPriceFields(t,e){const r={},i=`${t}${e}.DEFAULT.net`;r[i]=i;const o=`${t}${e}.DEFAULT.gross`;return r[o]=o,r}}class h{constructor(t){this.EntityDefinition=t}getEntity(t,e){const r=e.split("."),i=[];let o=this.EntityDefinition.get(t),s=!1,n=null,p=o.entity;return r.forEach(d=>{const l=o.properties[d];if(!l||d==="translations")return;if(l.flags.runtime===!0){o={entity:null};return}const m=l.entity;s=this.EntityDefinition.has(m),s&&(o=this.EntityDefinition.get(m),i.push(d),n=l.relation,p=d)}),{entity:o.entity,path:i.join("."),relation:n,name:p}}getSelected(t,e){const r=this.EntityDefinition.get(t),i=Object.keys(r.getPrimaryKeyFields())[0];if(!Array.isArray(e))return i;const o=this.getUpdateByMappingByEntity(t,e);return o?o.mappedKey:i}updateMapping(t,e,r){if(!e){this.removeUpdateByMappingByEntity(r,t.updateBy);return}if(!Array.isArray(t.updateBy)){t.updateBy=[{entityName:r,mappedKey:e}];return}const i=this.getUpdateByMappingByEntity(r,t.updateBy);if(!i){t.updateBy.push({entityName:r,mappedKey:e});return}i.mappedKey=e}getUpdateByMappingByEntity(t,e){const r=e.filter(i=>i.entityName===t);return r.length?r[0]:null}removeUpdateByMappingByEntity(t,e){if(!Array.isArray(e))return;const r=this.getUpdateByMappingByEntity(t,e);if(!r)return;const i=e.indexOf(r);i>-1&&e.splice(i,1)}removeUnusedMappings(t){if(!t||!Array.isArray(t.updateBy))return;if(!Array.isArray(t.mapping)||!t.mapping.length){t.updateBy=[];return}const e={};t.mapping.forEach(i=>{const{entity:o,path:s,relation:n}=this.getEntity(t.sourceEntity,i.key);if(n==="many_to_many"){e[o]=!0;return}e.hasOwnProperty(o)||(e[o]=[]);const p=s!==""?i.key.replace(new RegExp(`^(${s}.)`),""):i.key;e[o].push(p)}),t.updateBy.filter(i=>!e.hasOwnProperty(i.entityName)||Array.isArray(e[i.entityName])&&!e[i.entityName].includes(i.mappedKey)).forEach(i=>{this.removeUpdateByMappingByEntity(i.entityName,t.updateBy)})}}Shopware.Service("privileges").addPrivilegeMappingEntry({category:"additional_permissions",parent:null,key:"system",roles:{import_export:{privileges:["import_export_log:read","import_export_file:read","import_export_file:create","user:read","import_export_profile:read","import_export_profile:create","import_export_profile:delete","currency:read"],dependencies:[]}}});Shopware.Service().register("importExport",()=>new _(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")));Shopware.Service().register("importExportProfileMapping",()=>new u(Shopware.EntityDefinition));Shopware.Service().register("importExportUpdateByMapping",()=>new h(Shopware.EntityDefinition));Shopware.Component.register("sw-import-export",()=>a(()=>import("./index-C5H1QfDX.js"),__vite__mapDeps([0,1])));Shopware.Component.register("sw-import-export-exporter",()=>a(()=>import("./index-CRvZpqS8.js"),__vite__mapDeps([2,3])));Shopware.Component.register("sw-import-export-importer",()=>a(()=>import("./index-D5o0j6kg.js"),__vite__mapDeps([4,5])));Shopware.Component.register("sw-import-export-activity",()=>a(()=>import("./index-j2QiQMPv.js"),__vite__mapDeps([6,7])));Shopware.Component.register("sw-import-export-activity-log-info-modal",()=>a(()=>import("./index-CbEpgJrF.js"),__vite__mapDeps([8,9])));Shopware.Component.register("sw-import-export-activity-result-modal",()=>a(()=>import("./index-QGuQWuIX.js"),__vite__mapDeps([10,11])));Shopware.Component.register("sw-import-export-edit-profile-modal",()=>a(()=>import("./index-BiVKHvoA.js"),__vite__mapDeps([12,13])));Shopware.Component.register("sw-import-export-edit-profile-modal-mapping",()=>a(()=>import("./index-BnxjrPzf.js"),__vite__mapDeps([14,15])));Shopware.Component.register("sw-import-export-edit-profile-modal-identifiers",()=>a(()=>import("./index-DQ3gJEnU.js"),__vite__mapDeps([16,17])));Shopware.Component.register("sw-import-export-entity-path-select",()=>a(()=>import("./index-CrbP2RUY.js"),__vite__mapDeps([18,19])));Shopware.Component.register("sw-import-export-edit-profile-field-indicators",()=>a(()=>import("./index-IVv7628l.js"),__vite__mapDeps([20,21,22,23,24,25,26])));Shopware.Component.register("sw-import-export-edit-profile-import-settings",()=>a(()=>import("./index-D8U1zwyH.js"),__vite__mapDeps([27,28])));Shopware.Component.register("sw-import-export-edit-profile-general",()=>a(()=>import("./index-BNbkGdXo.js"),__vite__mapDeps([29,21,22,23,24,25,30])));Shopware.Component.register("sw-import-export-new-profile-wizard",()=>a(()=>import("./index-AUPdPW-k.js"),__vite__mapDeps([31,32])));Shopware.Component.register("sw-import-export-new-profile-wizard-general-page",()=>a(()=>import("./index-DD8ijXSo.js"),__vite__mapDeps([33,34,22,35,36])));Shopware.Component.register("sw-import-export-new-profile-wizard-csv-page",()=>a(()=>import("./index-CGJDKSST.js"),__vite__mapDeps([37,38])));Shopware.Component.register("sw-import-export-new-profile-wizard-mapping-page",()=>a(()=>import("./index-CECC1vmE.js"),__vite__mapDeps([39,22,40,41,42])));Shopware.Component.register("sw-import-export-view-import",()=>a(()=>import("./index-B7XNkGXm.js"),__vite__mapDeps([43,44])));Shopware.Component.register("sw-import-export-view-export",()=>a(()=>import("./index-C6QNqVtQ.js"),__vite__mapDeps([45,46])));Shopware.Component.register("sw-import-export-view-profiles",()=>a(()=>import("./index-C6nKZU-3.js"),__vite__mapDeps([47,48])));Shopware.Component.register("sw-import-export-progress",()=>a(()=>import("./index-SPknUrKR.js"),__vite__mapDeps([49,50])));Shopware.Module.register("sw-import-export",{type:"core",name:"ImportExport",title:"sw-import-export.general.mainMenuItemGeneral",description:"sw-import-export.general.descriptionTextModule",version:"1.0.0",targetVersion:"1.0.0",color:"#9AA8B5",icon:"regular-cog",entity:"import_export_profile",routePrefixPath:"sw/import-export",routes:{index:{component:"sw-import-export",path:"index",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"},redirect:{name:"sw.import.export.index.import"},children:{import:{component:"sw-import-export-view-import",path:"import",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},export:{component:"sw-import-export-view-export",path:"export",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}},profiles:{component:"sw-import-export-view-profiles",path:"profiles",meta:{parentPath:"sw.settings.index",privilege:"system.import_export"}}}}},settingsItem:{group:"automation",to:"sw.import.export.index",icon:"regular-database",privilege:"system.import_export"}});
