const r=`{% block sw_cms_detail_toolbar_language_switch %} <template #language-switch> <sw-language-switch disabled /> </template> {% endblock %} {% block sw_cms_detail_toolbar_actions_sales_channel %} {% endblock %} {% block sw_cms_detail_toolbar_actions_save %} <sw-button-process v-tooltip.bottom="tooltipSave" class="sw-cms-detail__save-action" :is-loading="isLoading" :process-success="isSaveSuccessful" :disabled="true" variant="primary" > {{ $tc('sw-cms.detail.label.buttonSave') }} </sw-button-process> {% endblock %} {% block sw_cms_detail_stage_container %} <sw-cms-create-wizard :page="page" @on-section-select="onAddSection($event, 0)" @wizard-complete="onWizardComplete" /> {% endblock %}`,{Mixin:c}=Shopware,o=Shopware.Utils,n={template:r,mixins:[c.getByName("placeholder")],data(){return{wizardComplete:!1}},beforeRouteEnter(e,t,s){e.name.includes("sw.cms.create")&&!e.params.id&&(e.params.id=o.createId()),s()},computed:{pageHasSections(){return this.page.sections.length>0&&this.wizardComplete},categoryRepository(){return this.repositoryFactory.create("category")}},methods:{createdComponent(){Shopware.Store.get("adminMenu").collapseSidebar(),this.resetRelatedStores();const e=Shopware.Store.get("context").isSystemDefaultLanguage;e||(Shopware.Store.get("context").resetLanguageToDefault(),Shopware.Store.get("cmsPage").setIsSystemDefaultLanguage(e)),this.page=this.pageRepository.create(),this.page.sections=new Shopware.Data.EntityCollection(`/cms-page/${this.page.id}/sections`,"cms_section",Shopware.Context.api)},async onSave(){return this.isSaveSuccessful=!1,this.isSystemDefaultLanguage&&!this.page.name||!this.page.type?(this.createNotificationWarning({message:this.$tc("sw-cms.detail.notification.messageMissingFields")}),Promise.reject()):(this.page=await this.assignToEntity(this.page),this.deleteEntityAndRequiredConfigKey(this.page.sections),this.isLoading=!0,this.pageRepository.save(this.page).then(()=>{this.isLoading=!1,this.isSaveSuccessful=!0,this.$router.push({name:"sw.cms.detail",params:{id:this.page.id}})}).catch(e=>(this.isLoading=!1,this.createNotificationError({message:e.message}),Promise.reject(e))))},async assignToEntity(e){const{type:t,id:s}=this.$route.params;if(!s||!t)return e;try{if(t==="category"){const a=await this.categoryRepository.get(s);a&&e.categories.push(a)}if(t.startsWith("ce_")||t.startsWith("custom_entity_")){const i=await this.repositoryFactory.create(t).get(s);i&&e.extensions[`${o.string.camelCase(t)}SwCmsPage`].push(i)}}catch{this.createNotificationError({message:this.$tc("sw-cms.create.notification.assignToEntityError")})}return e},onWizardComplete(){(this.page.type==="product_list"||this.page.type==="product_detail")&&this.onPageTypeChange(this.page.type),this.wizardComplete=!0,this.onSave()}}};export{n as default};
