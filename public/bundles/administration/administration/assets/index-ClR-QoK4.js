const g="global.default.error",l={2:"messageUnsupportedGrantType",3:"messageInvalidRequest",4:"messageInvalidClient",5:"messageInvalidScope",6:"messageInvalidCredentials",7:"messageServerError",8:"messageInvalidRefreshToken",9:"messageAccessDenied",10:"messageInvalidCredentials"};function d(e,o="sw-login.index."){return{message:l[e]?`${o}${l[e]}`:"",title:g}}const c=`{% block sw_login_login %} <form class="sw-login-login" @submit.prevent="loginUserWithPassword" > {% block sw_login_login_form_headline %} <h2 class="sw-login__content-headline"> {{ $tc('sw-login.index.headlineForm') }} </h2> {% endblock %} {% block sw_login_login_alert %} <mt-banner v-if="showLoginAlert" variant="info" :show-icon="true" :closable="false" > {{ loginAlertMessage }} </mt-banner> {% endblock %} <div v-if="loginConfigLoaded"> <template v-if="loginConfig.useDefault"> {% block sw_login_login_user_field %} <mt-text-field v-model="username" v-autofocus name="sw-field--username" :label="$tc('sw-login.index.labelUsername')" :placeholder="$tc('sw-login.index.placeholderUsername')" :disabled="showLoginAlert" required /> {% endblock %} {% block sw_login_login_password_field %} <mt-password-field v-model="password" name="sw-field--password" :label="$tc('sw-login.index.labelPassword')" :placeholder="$tc('sw-login.index.placeholderPassword')" :disabled="showLoginAlert" required /> {% endblock %} <mt-checkbox v-model:checked="rememberMe" :label="$tc('sw-login.index.labelKeepLoggedIn')" /> {% block sw_login_login_submit %} <div class="sw-login__submit"> {% block sw_login_login_forgot_password %} <router-link :to="{ name: 'sw.login.index.recovery' }" class="sw-login__forgot-password-action" > {{ $tc('sw-login.index.forgottenPasswordLink') }} </router-link> {% endblock %} {% block sw_login_login_submit_button %} <mt-button :disabled="password.length <= 0 || username.length <= 0 || showLoginAlert" class="sw-login__login-action" variant="primary" type="submit" > {{ $tc('sw-login.index.buttonLogin') }} </mt-button> {% endblock %} </div> {% endblock %} </template> <div v-if="loginConfig.url"> <a class="sw-button sw-button--primary sw-button--small sw-login__sso-button" :disabled="!loginConfigLoaded" :href="loginConfig.url" @click.prevent="doSsoForwarding" > {{ $tc('sw-login.index.buttonSsoLogin') }} <mt-icon name="regular-shopware" /> </a> </div> </div> <div v-else> <sw-loader /> </div> </form> {% endblock %}`,{Component:m,Mixin:h}=Shopware,u=m.wrapComponentConfig({template:c,inject:["loginService","userService","licenseViolationService"],emits:["is-loading","is-not-loading","login-success","login-error"],mixins:[h.getByName("notification")],data(){return{username:"",password:"",rememberMe:!1,loginAlertMessage:"",loginConfig:null,loginConfigLoaded:!1}},computed:{showLoginAlert(){return typeof this.loginAlertMessage=="string"&&this.loginAlertMessage.length>=1}},created(){this.createdComponent()},methods:{async createdComponent(){localStorage.getItem("sw-admin-locale")||await Shopware.Store.get("session").setAdminLocale(navigator.language),this.loginConfig=await this.loginService.getLoginTemplateConfig(),this.loginConfigLoaded=!0,!this.loginConfig.useDefault&&this.loginConfig.url&&this.doSsoForwarding()},doSsoForwarding(){this.loginConfig&&(window.sessionStorage.setItem("redirectFromLogin","true"),window.location.href=this.loginConfig.url)},loginUserWithPassword(){return this.$emit("is-loading"),this.loginService.setRememberMe(this.rememberMe),this.loginService.loginByUsername(this.username,this.password).then(()=>{this.handleLoginSuccess(),this.$emit("is-not-loading")}).catch(e=>{this.password="",this.handleLoginError(e),this.$emit("is-not-loading")})},handleLoginSuccess(){this.password="",this.$emit("login-success");const e=new Promise(o=>{setTimeout(o,150)});return this.licenseViolationService&&this.licenseViolationService.removeTimeFromLocalStorage(this.licenseViolationService.key.showViolationsKey),e.then(async()=>{this.$parent.isLoginSuccess=!1,await this.forwardLogin(),sessionStorage.getItem("sw-login-should-reload")&&(sessionStorage.removeItem("sw-login-should-reload"),window.location.reload(!0))})},async forwardLogin(){var i,s,t,n;const e=JSON.parse(sessionStorage.getItem("sw-admin-previous-route"));if(sessionStorage.removeItem("sw-admin-previous-route"),Shopware.Context.app.firstRunWizard&&!((n=(t=(s=(i=this.$router)==null?void 0:i.currentRoute)==null?void 0:s.value)==null?void 0:t.name)!=null&&n.startsWith("sw.first.run.wizard"))&&this.$router.hasRoute("sw.first.run.wizard.index")){await this.$router.push({name:"sw.first.run.wizard.index"});return}if(e!=null&&e.fullPath){await this.$router.push(e.fullPath);return}await this.$router.push({name:"core"})},handleLoginError(e){this.password="",this.$emit("login-error"),setTimeout(()=>{this.$emit("login-error")},500),this.createNotificationFromResponse(e)},createNotificationFromResponse(e){var s,t,n;if(!e.response){this.createNotificationError({message:this.$tc("sw-login.index.messageGeneralRequestError")});return}const o=e.config.url;let i=e.response.data.errors;if(i=Array.isArray(i)?i[0]:i,parseInt(i.status,10)===429){const r=(t=(s=i==null?void 0:i.meta)==null?void 0:s.parameters)==null?void 0:t.seconds;this.loginAlertMessage=this.$tc("sw-login.index.messageAuthThrottled",{seconds:r},0),setTimeout(()=>{this.loginAlertMessage=""},r*1e3);return}if((n=i.code)!=null&&n.length){const{message:r,title:a}=d(parseInt(i.code,10));this.createNotificationError({title:this.$tc(a),message:this.$tc(r,0,{url:o})})}}}});export{u as default};
